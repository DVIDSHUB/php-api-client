# Version Management

This document describes the version management system for the DVIDS PHP SDK.

## Overview

The SDK uses semantic versioning (semver) and includes the version in the User-Agent header of all HTTP requests. The version is managed through:

1. **Version Constant**: Defined in `src/Version.php`
2. **Update Script**: `scripts/update-version.php` for manual/CI updates
3. **GitHub Actions**: Automatic version updates during releases

## Current Version

The current version is defined in `src/Version.php`:

```php
<?php path=src/Version.php start=17
public const SDK_VERSION = '0.0.1';
```

## User-Agent Header

All HTTP requests include a User-Agent header with the format:

```
DVIDS-PHP-Client/0.0.1
```

This is automatically generated by the `Version::getUserAgent()` method and used by the `DvidsApiClient`.

## Version Update Methods

### 1. Manual Update

Edit `src/Version.php` directly:

```php
<?php path=null start=null
// Change this line:
public const SDK_VERSION = '0.0.1';
// To:
public const SDK_VERSION = '0.0.2';
```

### 2. Script Update

Use the provided PHP script for validation and automated updating:

```bash
# Show current version
php scripts/update-version.php --current

# Update to a new version
php scripts/update-version.php 2.1.0

# Show help
php scripts/update-version.php --help
```

The script will:
- Validate the version format (semantic versioning)
- Update the version constant in the file
- Verify the update was successful

### 3. GitHub Actions (Automated)

The preferred method for releases is through GitHub Actions:

1. **Create and push a version tag:**
   ```bash
   git tag v2.1.0
   git push origin v2.1.0
   ```

2. **GitHub Actions will automatically:**
   - Extract the version from the tag (removing the 'v' prefix)
   - Update `src/Version.php` with the new version
   - Run tests to ensure everything works
   - Create a GitHub release
   - Generate a changelog
   - Create distribution packages

## Version Format

The SDK follows [Semantic Versioning 2.0.0](https://semver.org/):

- **MAJOR.MINOR.PATCH** (e.g., `1.0.0`)
- **Pre-release versions** are supported (e.g., `1.0.0-beta.1`, `2.0.0-alpha.2`)
- **Build metadata** is supported (e.g., `1.0.0+build.1`)

### Version Components

- **Major**: Incremented for incompatible API changes
- **Minor**: Incremented for backward-compatible functionality additions
- **Patch**: Incremented for backward-compatible bug fixes

## Release Process

### Standard Release

1. **Prepare changes**: Ensure all changes are committed and tested
2. **Create tag**: `git tag v1.2.3` (replace with actual version)
3. **Push tag**: `git push origin v1.2.3`
4. **Monitor workflow**: Check GitHub Actions for successful completion
5. **Verify release**: Confirm the release appears on GitHub with correct assets

### Pre-release

For beta, alpha, or release candidate versions:

1. **Create pre-release tag**: `git tag v1.2.3-beta.1`
2. **Push tag**: `git push origin v1.2.3-beta.1`
3. **GitHub Actions will mark it as a pre-release**

## Testing Version Updates

You can test the version system using the provided example:

```bash
php examples/version_example.php
```

This will show:
- Current SDK version
- User-Agent format
- Version validation
- HTTP request header verification

## Continuous Integration

The GitHub Actions workflow (`.github/workflows/release.yml`) handles:

1. **Version Extraction**: From git tags (removes 'v' prefix)
2. **Version Update**: Using the PHP script
3. **Testing**: Runs PHPUnit tests to ensure compatibility
4. **Release Creation**: Automated GitHub releases with changelogs
5. **Asset Generation**: Creates distribution packages

## Troubleshooting

### Version Script Issues

**Script not found:**
```bash
# Ensure you're in the project root
cd /path/to/dvids-php-sdk
php scripts/update-version.php --current
```

**Invalid version format:**
```bash
# Use semantic versioning format
php scripts/update-version.php 1.0.0        # ✓ Valid
php scripts/update-version.php 1.0          # ✗ Invalid
php scripts/update-version.php v1.0.0       # ✗ Invalid (no 'v' prefix)
```

### GitHub Actions Issues

**Workflow not triggering:**
- Ensure tag follows `v*` pattern (e.g., `v1.0.0`)
- Check repository permissions for Actions
- Verify `GITHUB_TOKEN` has appropriate permissions

**Version update failed:**
- Check if `scripts/update-version.php` exists and is executable
- Verify PHP version compatibility in workflow
- Check script output in Actions logs

## Examples

### Update Version Manually

```bash
# Check current version
php scripts/update-version.php --current
# Output: Current version: 1.0.0

# Update to new version
php scripts/update-version.php 1.1.0
# Output: Current version: 1.0.0
#         New version: 1.1.0
#         ✓ Successfully updated version to 1.1.0
#         ✓ Version update verified
```

### Release via GitHub Actions

```bash
# Create and push version tag
git tag v1.1.0
git push origin v1.1.0

# GitHub Actions will:
# - Update src/Version.php to version '1.1.0'
# - Run tests
# - Create release "DVIDS PHP SDK 1.1.0"
# - Upload distribution assets
```

## File Locations

- **Version constant**: `src/Version.php`
- **Update script**: `scripts/update-version.php`
- **GitHub workflow**: `.github/workflows/release.yml`
- **Version tests**: `tests/VersionTest.php`
- **Example**: `examples/version_example.php`
- **Documentation**: `VERSION.md` (this file)